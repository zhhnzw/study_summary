## 缓存

### 高并发下的缓存更新策略

写操作函数：对数据库的写操作执行之后，删除缓存，延迟一定的时间之后，再删除一次
读操作函数：查缓存，不存在就去读数据库，写入缓存，为避免造成缓存击穿的问题，可使用`singleflight`来读取数据库和更新缓存。

原因考虑如下场景：

1. 缓存刚好失效
2. 请求A查询数据库，得一个旧值
3. 请求B将新值写入数据库
4. 请求B删除缓存
5. 请求A将查到的旧值写入缓存

延迟删除的时间如何确定：

在读数据业务逻辑的耗时基础上，加几百ms即可。这么做的目的，就是确保读请求结束，写请求可以删除读请求造成的缓存脏数据。

mysql读写分离架构的主从数据不一致问题也是类似的解决方案，只不过是把延迟删除的时间与主从同步的延时时间相关联。
